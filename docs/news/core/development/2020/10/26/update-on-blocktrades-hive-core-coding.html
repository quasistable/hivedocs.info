<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="/assets/images/sticker.png" /><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Update on BlockTrades Hive core coding | Hive Chain Documentation</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Update on BlockTrades Hive core coding" />
<meta name="author" content="blocktrades" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="We’ve spent the past week analyzing the performance of Eclipse hived/hivemind in our API service (api.hive.blog) and making improvements based on real-world loading patterns. It’s been a very productive week and we’ve resolved most of the outstanding issues reported and performance problems we observed. We’ve also identified and fixed several longstanding issues in the hived mutex locking code that prevented peak performance and led to potential data corruption issues. # Hived work (blockchain node software) We made a number of non-consensus changes to improve hived performance and fix old bugs: We reviewed the locking used to protect the chainbase database and found several serious longstanding bugs that showed up under high stress API loading of a hived node. These bugs could lead to data corruption and non-optimal performance. Those fixes are incorporated into this merge request: https://gitlab.syncad.com/hive/hive/-/merge_requests/143 After fixing these problems, we ran several high stress tests using the `siege` tool and were unable to “break” hived’s operation anymore. We were also able to get hived to fully utilize all the server’s cores (48 on our test system), demonstrating that the locking is fairly optimal for realistic loads. As a performance optimization, we enabled filtering of operations returned by one of the most time-consuming API calls, `get_account_history`: https://gitlab.syncad.com/hive/hive/-/merge_requests/136 https://gitlab.syncad.com/hive/hive/-/merge_requests/137 https://gitlab.syncad.com/hive/hive/-/merge_requests/139 We made several changes to API responses returned by hived, mostly in response to reports from apps developers: https://gitlab.syncad.com/hive/hive/-/merge_requests/125 https://gitlab.syncad.com/hive/hive/-/merge_requests/126 https://gitlab.syncad.com/hive/hive/-/merge_requests/133 We also limited the max number of operation of operations to that can be fetched by this call to 1k operations (previously it allowed up to 10k operations) to optimize hived throughput: https://gitlab.syncad.com/hive/hive/-/commit/9a05f4d780fc98b891f51ab4b88ebec89fde467b We corrected account-impacting for several virtual operations created recently: https://gitlab.syncad.com/hive/hive/-/merge_requests/134 ## Hived status We started a full replay and a full sync early this morning to check all the above changes (full replay takes around 18 hours). We don’t expect any issues, but there is a very small chance for issues due to the mutex locking changes, even though no consensus changes were made. With these changes, I think hived’s performance and reliability has been substantially improved over its past condition and it seems quite solid in the face of very substantial API traffic loading. One minor issue still to be resolved is the longstanding issue with hived crashing if it receives API traffic when starting up, so we may tackle that next, since it can be an annoyance when updating several hiveds deployed inside of a API server node configuration. **As this version contains substantial operational improvements, we’ve tagged this version as [v1.24.5](https://gitlab.syncad.com/hive/hive/-/releases/v1.24.5), and it’s a strongly recommended upgrade for all API server nodes. However, there’s no need for exchanges or consensus nodes to upgrade to this version, since the performance improvements mostly come into play when a node is handling significant API traffic.** # Hivemind We made numerous optimizations and bug fixes in hivemind this past week: https://gitlab.syncad.com/hive/hivemind/-/merge_requests/311 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/306 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/312 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/314 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/291 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/280 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/316 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/318 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/323 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/226 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/322 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/289 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/315 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/326 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/321 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/325 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/328 ## Hivemind status (2nd layer social media microservice) By late tomorrow I expect we’ll have resolved all the remaining big issues with hivemind responses and performance, other than reputation support (which we’ve intentionally left out until all other issues were resolved). # Condenser + Condenser wallet (open-source code for **hive.blog**) Merged in support for decentralized lists: https://gitlab.syncad.com/hive/condenser/-/merge_requests/135 This functionality is still waiting one last issue to be resolved in hivemind, so it won’t be fully testable until tomorrow when we deploy a new version of hivemind. We made numerous changes this week to improve condenser’s wallet (corrected some display issues and improved performance of page loads by using newer, faster API calls), including new features in the proposals page: https://gitlab.syncad.com/hive/wallet/-/merge_requests/42 https://gitlab.syncad.com/hive/wallet/-/merge_requests/43 https://gitlab.syncad.com/hive/wallet/-/merge_requests/45 https://gitlab.syncad.com/hive/wallet/-/merge_requests/52 https://gitlab.syncad.com/hive/wallet/-/merge_requests/54 https://gitlab.syncad.com/hive/wallet/-/merge_requests/55 https://gitlab.syncad.com/hive/wallet/-/merge_requests/56 https://gitlab.syncad.com/hive/wallet/-/merge_requests/57 https://gitlab.syncad.com/hive/wallet/-/merge_requests/60 https://gitlab.syncad.com/hive/wallet/-/merge_requests/62 https://gitlab.syncad.com/hive/wallet/-/merge_requests/64 https://gitlab.syncad.com/hive/wallet/-/merge_requests/65 https://gitlab.syncad.com/hive/wallet/-/merge_requests/68 https://gitlab.syncad.com/hive/wallet/-/merge_requests/70 Proposals page changes: https://gitlab.syncad.com/hive/wallet/-/merge_requests/47 https://gitlab.syncad.com/hive/wallet/-/merge_requests/49 https://gitlab.syncad.com/hive/wallet/-/merge_requests/51 ## Condenser status Condenser is looking pretty good at this point, but we’ll continue to test and look for any remaining problems. # Hive-js improvements In order to make hive.blog faster, we modified hive-js to support the new option to filter the operations fetched by the get_account_history call: https://gitlab.syncad.com/hive/hive-js/-/merge_requests/12 https://gitlab.syncad.com/hive/hive-js/-/merge_requests/13 https://gitlab.syncad.com/hive/hive-js/-/merge_requests/14 # What’s next for the week? Tomorrow we’ll hopefully be deploying a new hivemind with all the performance improvements and fixes we made in the last week, after some real world traffic testing on our API node. We’ll also be testing condenser and the wallet and looking for fixes and optimizations we can make. **Assuming deployment of latest hivemind goes well tomorrow, we’ll likely still need to make a few more fixes as issues get reported, but I expect that by the latter part of the coming week we can begin to analyze feasibility for various previously suggested features for HF25 and also intermediate changes that aren’t consensus changes that can be released earlier.** See: Update on BlockTrades Hive core coding by @blocktrades" />
<meta property="og:description" content="We’ve spent the past week analyzing the performance of Eclipse hived/hivemind in our API service (api.hive.blog) and making improvements based on real-world loading patterns. It’s been a very productive week and we’ve resolved most of the outstanding issues reported and performance problems we observed. We’ve also identified and fixed several longstanding issues in the hived mutex locking code that prevented peak performance and led to potential data corruption issues. # Hived work (blockchain node software) We made a number of non-consensus changes to improve hived performance and fix old bugs: We reviewed the locking used to protect the chainbase database and found several serious longstanding bugs that showed up under high stress API loading of a hived node. These bugs could lead to data corruption and non-optimal performance. Those fixes are incorporated into this merge request: https://gitlab.syncad.com/hive/hive/-/merge_requests/143 After fixing these problems, we ran several high stress tests using the `siege` tool and were unable to “break” hived’s operation anymore. We were also able to get hived to fully utilize all the server’s cores (48 on our test system), demonstrating that the locking is fairly optimal for realistic loads. As a performance optimization, we enabled filtering of operations returned by one of the most time-consuming API calls, `get_account_history`: https://gitlab.syncad.com/hive/hive/-/merge_requests/136 https://gitlab.syncad.com/hive/hive/-/merge_requests/137 https://gitlab.syncad.com/hive/hive/-/merge_requests/139 We made several changes to API responses returned by hived, mostly in response to reports from apps developers: https://gitlab.syncad.com/hive/hive/-/merge_requests/125 https://gitlab.syncad.com/hive/hive/-/merge_requests/126 https://gitlab.syncad.com/hive/hive/-/merge_requests/133 We also limited the max number of operation of operations to that can be fetched by this call to 1k operations (previously it allowed up to 10k operations) to optimize hived throughput: https://gitlab.syncad.com/hive/hive/-/commit/9a05f4d780fc98b891f51ab4b88ebec89fde467b We corrected account-impacting for several virtual operations created recently: https://gitlab.syncad.com/hive/hive/-/merge_requests/134 ## Hived status We started a full replay and a full sync early this morning to check all the above changes (full replay takes around 18 hours). We don’t expect any issues, but there is a very small chance for issues due to the mutex locking changes, even though no consensus changes were made. With these changes, I think hived’s performance and reliability has been substantially improved over its past condition and it seems quite solid in the face of very substantial API traffic loading. One minor issue still to be resolved is the longstanding issue with hived crashing if it receives API traffic when starting up, so we may tackle that next, since it can be an annoyance when updating several hiveds deployed inside of a API server node configuration. **As this version contains substantial operational improvements, we’ve tagged this version as [v1.24.5](https://gitlab.syncad.com/hive/hive/-/releases/v1.24.5), and it’s a strongly recommended upgrade for all API server nodes. However, there’s no need for exchanges or consensus nodes to upgrade to this version, since the performance improvements mostly come into play when a node is handling significant API traffic.** # Hivemind We made numerous optimizations and bug fixes in hivemind this past week: https://gitlab.syncad.com/hive/hivemind/-/merge_requests/311 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/306 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/312 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/314 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/291 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/280 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/316 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/318 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/323 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/226 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/322 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/289 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/315 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/326 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/321 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/325 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/328 ## Hivemind status (2nd layer social media microservice) By late tomorrow I expect we’ll have resolved all the remaining big issues with hivemind responses and performance, other than reputation support (which we’ve intentionally left out until all other issues were resolved). # Condenser + Condenser wallet (open-source code for **hive.blog**) Merged in support for decentralized lists: https://gitlab.syncad.com/hive/condenser/-/merge_requests/135 This functionality is still waiting one last issue to be resolved in hivemind, so it won’t be fully testable until tomorrow when we deploy a new version of hivemind. We made numerous changes this week to improve condenser’s wallet (corrected some display issues and improved performance of page loads by using newer, faster API calls), including new features in the proposals page: https://gitlab.syncad.com/hive/wallet/-/merge_requests/42 https://gitlab.syncad.com/hive/wallet/-/merge_requests/43 https://gitlab.syncad.com/hive/wallet/-/merge_requests/45 https://gitlab.syncad.com/hive/wallet/-/merge_requests/52 https://gitlab.syncad.com/hive/wallet/-/merge_requests/54 https://gitlab.syncad.com/hive/wallet/-/merge_requests/55 https://gitlab.syncad.com/hive/wallet/-/merge_requests/56 https://gitlab.syncad.com/hive/wallet/-/merge_requests/57 https://gitlab.syncad.com/hive/wallet/-/merge_requests/60 https://gitlab.syncad.com/hive/wallet/-/merge_requests/62 https://gitlab.syncad.com/hive/wallet/-/merge_requests/64 https://gitlab.syncad.com/hive/wallet/-/merge_requests/65 https://gitlab.syncad.com/hive/wallet/-/merge_requests/68 https://gitlab.syncad.com/hive/wallet/-/merge_requests/70 Proposals page changes: https://gitlab.syncad.com/hive/wallet/-/merge_requests/47 https://gitlab.syncad.com/hive/wallet/-/merge_requests/49 https://gitlab.syncad.com/hive/wallet/-/merge_requests/51 ## Condenser status Condenser is looking pretty good at this point, but we’ll continue to test and look for any remaining problems. # Hive-js improvements In order to make hive.blog faster, we modified hive-js to support the new option to filter the operations fetched by the get_account_history call: https://gitlab.syncad.com/hive/hive-js/-/merge_requests/12 https://gitlab.syncad.com/hive/hive-js/-/merge_requests/13 https://gitlab.syncad.com/hive/hive-js/-/merge_requests/14 # What’s next for the week? Tomorrow we’ll hopefully be deploying a new hivemind with all the performance improvements and fixes we made in the last week, after some real world traffic testing on our API node. We’ll also be testing condenser and the wallet and looking for fixes and optimizations we can make. **Assuming deployment of latest hivemind goes well tomorrow, we’ll likely still need to make a few more fixes as issues get reported, but I expect that by the latter part of the coming week we can begin to analyze feasibility for various previously suggested features for HF25 and also intermediate changes that aren’t consensus changes that can be released earlier.** See: Update on BlockTrades Hive core coding by @blocktrades" />
<link rel="canonical" href="https://hive.blog/hive-139531/@blocktrades/update-on-blocktrades-hive-core-coding" />
<meta property="og:url" content="https://hive.blog/hive-139531/@blocktrades/update-on-blocktrades-hive-core-coding" />
<meta property="og:site_name" content="Hive Chain Documentation" />
<meta property="og:image" content="https://hivedocs.info/assets/images/favicon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-26T14:24:48-07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://hivedocs.info/assets/images/favicon.png" />
<meta property="twitter:title" content="Update on BlockTrades Hive core coding" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://hive.blog/hive-139531/@blocktrades/update-on-blocktrades-hive-core-coding"},"description":"We’ve spent the past week analyzing the performance of Eclipse hived/hivemind in our API service (api.hive.blog) and making improvements based on real-world loading patterns. It’s been a very productive week and we’ve resolved most of the outstanding issues reported and performance problems we observed. We’ve also identified and fixed several longstanding issues in the hived mutex locking code that prevented peak performance and led to potential data corruption issues. # Hived work (blockchain node software) We made a number of non-consensus changes to improve hived performance and fix old bugs: We reviewed the locking used to protect the chainbase database and found several serious longstanding bugs that showed up under high stress API loading of a hived node. These bugs could lead to data corruption and non-optimal performance. Those fixes are incorporated into this merge request: https://gitlab.syncad.com/hive/hive/-/merge_requests/143 After fixing these problems, we ran several high stress tests using the `siege` tool and were unable to “break” hived’s operation anymore. We were also able to get hived to fully utilize all the server’s cores (48 on our test system), demonstrating that the locking is fairly optimal for realistic loads. As a performance optimization, we enabled filtering of operations returned by one of the most time-consuming API calls, `get_account_history`: https://gitlab.syncad.com/hive/hive/-/merge_requests/136 https://gitlab.syncad.com/hive/hive/-/merge_requests/137 https://gitlab.syncad.com/hive/hive/-/merge_requests/139 We made several changes to API responses returned by hived, mostly in response to reports from apps developers: https://gitlab.syncad.com/hive/hive/-/merge_requests/125 https://gitlab.syncad.com/hive/hive/-/merge_requests/126 https://gitlab.syncad.com/hive/hive/-/merge_requests/133 We also limited the max number of operation of operations to that can be fetched by this call to 1k operations (previously it allowed up to 10k operations) to optimize hived throughput: https://gitlab.syncad.com/hive/hive/-/commit/9a05f4d780fc98b891f51ab4b88ebec89fde467b We corrected account-impacting for several virtual operations created recently: https://gitlab.syncad.com/hive/hive/-/merge_requests/134 ## Hived status We started a full replay and a full sync early this morning to check all the above changes (full replay takes around 18 hours). We don’t expect any issues, but there is a very small chance for issues due to the mutex locking changes, even though no consensus changes were made. With these changes, I think hived’s performance and reliability has been substantially improved over its past condition and it seems quite solid in the face of very substantial API traffic loading. One minor issue still to be resolved is the longstanding issue with hived crashing if it receives API traffic when starting up, so we may tackle that next, since it can be an annoyance when updating several hiveds deployed inside of a API server node configuration. **As this version contains substantial operational improvements, we’ve tagged this version as [v1.24.5](https://gitlab.syncad.com/hive/hive/-/releases/v1.24.5), and it’s a strongly recommended upgrade for all API server nodes. However, there’s no need for exchanges or consensus nodes to upgrade to this version, since the performance improvements mostly come into play when a node is handling significant API traffic.** # Hivemind We made numerous optimizations and bug fixes in hivemind this past week: https://gitlab.syncad.com/hive/hivemind/-/merge_requests/311 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/306 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/312 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/314 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/291 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/280 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/316 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/318 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/323 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/226 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/322 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/289 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/315 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/326 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/321 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/325 https://gitlab.syncad.com/hive/hivemind/-/merge_requests/328 ## Hivemind status (2nd layer social media microservice) By late tomorrow I expect we’ll have resolved all the remaining big issues with hivemind responses and performance, other than reputation support (which we’ve intentionally left out until all other issues were resolved). # Condenser + Condenser wallet (open-source code for **hive.blog**) Merged in support for decentralized lists: https://gitlab.syncad.com/hive/condenser/-/merge_requests/135 This functionality is still waiting one last issue to be resolved in hivemind, so it won’t be fully testable until tomorrow when we deploy a new version of hivemind. We made numerous changes this week to improve condenser’s wallet (corrected some display issues and improved performance of page loads by using newer, faster API calls), including new features in the proposals page: https://gitlab.syncad.com/hive/wallet/-/merge_requests/42 https://gitlab.syncad.com/hive/wallet/-/merge_requests/43 https://gitlab.syncad.com/hive/wallet/-/merge_requests/45 https://gitlab.syncad.com/hive/wallet/-/merge_requests/52 https://gitlab.syncad.com/hive/wallet/-/merge_requests/54 https://gitlab.syncad.com/hive/wallet/-/merge_requests/55 https://gitlab.syncad.com/hive/wallet/-/merge_requests/56 https://gitlab.syncad.com/hive/wallet/-/merge_requests/57 https://gitlab.syncad.com/hive/wallet/-/merge_requests/60 https://gitlab.syncad.com/hive/wallet/-/merge_requests/62 https://gitlab.syncad.com/hive/wallet/-/merge_requests/64 https://gitlab.syncad.com/hive/wallet/-/merge_requests/65 https://gitlab.syncad.com/hive/wallet/-/merge_requests/68 https://gitlab.syncad.com/hive/wallet/-/merge_requests/70 Proposals page changes: https://gitlab.syncad.com/hive/wallet/-/merge_requests/47 https://gitlab.syncad.com/hive/wallet/-/merge_requests/49 https://gitlab.syncad.com/hive/wallet/-/merge_requests/51 ## Condenser status Condenser is looking pretty good at this point, but we’ll continue to test and look for any remaining problems. # Hive-js improvements In order to make hive.blog faster, we modified hive-js to support the new option to filter the operations fetched by the get_account_history call: https://gitlab.syncad.com/hive/hive-js/-/merge_requests/12 https://gitlab.syncad.com/hive/hive-js/-/merge_requests/13 https://gitlab.syncad.com/hive/hive-js/-/merge_requests/14 # What’s next for the week? Tomorrow we’ll hopefully be deploying a new hivemind with all the performance improvements and fixes we made in the last week, after some real world traffic testing on our API node. We’ll also be testing condenser and the wallet and looking for fixes and optimizations we can make. **Assuming deployment of latest hivemind goes well tomorrow, we’ll likely still need to make a few more fixes as issues get reported, but I expect that by the latter part of the coming week we can begin to analyze feasibility for various previously suggested features for HF25 and also intermediate changes that aren’t consensus changes that can be released earlier.** See: Update on BlockTrades Hive core coding by @blocktrades","@type":"BlogPosting","image":"https://hivedocs.info/assets/images/favicon.png","url":"https://hive.blog/hive-139531/@blocktrades/update-on-blocktrades-hive-core-coding","headline":"Update on BlockTrades Hive core coding","dateModified":"2020-10-26T14:24:48-07:00","datePublished":"2020-10-26T14:24:48-07:00","author":{"@type":"Person","name":"blocktrades"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://hivedocs.info/feed.xml" title="Hive Chain Documentation" /><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-161692811-1', 'auto');
  ga('send', 'pageview');
}
</script>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turbolinks/5.2.0/turbolinks.js" integrity="sha256-iM4Yzi/zLj/IshPWMC1IluRxTtRjMqjPGd97TZ9yYpU=" crossorigin="anonymous"></script>
  <script src='https://unpkg.com/steem-content-renderer'></script>
  <script>
    (function () {
      if (Turbolinks.supported) {
        Turbolinks.setProgressBarDelay(500);
      }
    })();
  </script>
  <script src="/assets/javascript/universal-bridge-against-phishing.js"></script>
  <script src="/assets/javascript/lazysizes.min.js" async=""></script>
  <script src="/assets/javascript/authors.js" async=""></script>
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Cousine|Inconsolata" rel="stylesheet">
  <link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png">
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Hive Chain Documentation</a>

      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/news/">News</a><a class="page-link" href="/howto/">How To</a><a class="page-link" href="/links/">Useful Links</a><!-- HTML elements for search -->
          <input type="text" id="search-input" placeholder="Search" />
          
          <ul id="results-container"></ul>

          <script src="/assets/javascript/search.js"></script>
          <script>
            var sjs = SimpleJekyllSearch({
              searchInput: document.getElementById('search-input'),
              resultsContainer: document.getElementById('results-container'),
              json: '/search.json'
            })
          </script>
          <!-- <form style="float: right;" class="form-inline" method="get" action="http://www.google.com/search">
            <input type="hidden" name="sitesearch" value="hivedocs.info" />
            <input type="text" name="q" maxlength="255" placeholder="Search" />
          </form> -->
          
          
          <a href="#" onclick="try { $('#topics-container').slideToggle(); } catch { document.getElementById('topics-container').style.display = 'block'; }; return false;">Topics &#187;</a>
          
          <ul id="topics-container" style="display: none;"><li><a class="page-link" href="/account-recovery/"><nobr>Account Recovery</nobr></a></li><li><a class="page-link" href="/core-development/"><nobr>Core Development</nobr></a></li><li><a class="page-link" href="/dapps/"><nobr>Dapps</nobr></a></li><li><a class="page-link" href="/docker/"><nobr>Docker</nobr></a></li><li><a class="page-link" href="/hardfork/"><nobr>Hardfork</nobr></a></li><li><a class="page-link" href="/hivemind/"><nobr>Hivemind</nobr></a></li><li><a class="page-link" href="/javascript/"><nobr>Javascript</nobr></a></li><li><a class="page-link" href="/multisig/"><nobr>Multisig</nobr></a></li><li><a class="page-link" href="/python/"><nobr>Python</nobr></a></li><li><a class="page-link" href="/ruby/"><nobr>Ruby</nobr></a></li><li><a class="page-link" href="/testnet/"><nobr>Testnet</nobr></a></li><li><a class="page-link" href="/tools/"><nobr>Tools</nobr></a></li></ul>
        </div>
      </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Update on BlockTrades Hive core coding</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-10-26T14:24:48-07:00" itemprop="datePublished">Oct 26, 2020
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">
          <a href="https://hive.blog/@blocktrades">blocktrades</a>
        </span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div id="content-blocktrades-update-on-blocktrades-hive-core-coding">We’ve spent the past week analyzing the performance of Eclipse hived/hivemind in our API service (api.hive.blog) and making improvements based on real-world loading patterns. 

It’s been a very productive week and we’ve resolved most of the outstanding issues reported and performance problems we observed. We’ve also identified and fixed several longstanding issues in the hived mutex locking code that prevented peak performance and led to potential data corruption issues.

# Hived work (blockchain node software)

We made a number of non-consensus changes to improve hived performance and fix old bugs:

We reviewed the locking used to protect the chainbase database and found several serious longstanding bugs that showed up under high stress API loading of a hived node. These bugs could lead to data corruption and non-optimal performance. Those fixes are incorporated into this merge request:
https://gitlab.syncad.com/hive/hive/-/merge_requests/143


After fixing these problems, we ran several high stress tests using the `siege` tool and were unable to “break” hived’s operation anymore. We were also able to get hived to fully utilize all the server’s cores (48 on our test system), demonstrating that the locking is fairly optimal for realistic loads.

As a performance optimization, we enabled filtering of operations returned by one of the most time-consuming API calls, `get_account_history`: 
https://gitlab.syncad.com/hive/hive/-/merge_requests/136
https://gitlab.syncad.com/hive/hive/-/merge_requests/137
https://gitlab.syncad.com/hive/hive/-/merge_requests/139


We made several changes to API responses returned by hived, mostly in response to reports from apps developers:
https://gitlab.syncad.com/hive/hive/-/merge_requests/125
https://gitlab.syncad.com/hive/hive/-/merge_requests/126
https://gitlab.syncad.com/hive/hive/-/merge_requests/133

We also limited the max number of operation of operations to  that can be fetched by this call to 1k operations (previously it allowed up to 10k operations) to optimize hived throughput: https://gitlab.syncad.com/hive/hive/-/commit/9a05f4d780fc98b891f51ab4b88ebec89fde467b

We corrected account-impacting for several virtual operations created recently:
https://gitlab.syncad.com/hive/hive/-/merge_requests/134

## Hived status

We started a full replay and a full sync early this morning to check all the above changes (full replay takes around 18 hours). We don’t expect any issues, but there is a very small chance for issues due to the mutex locking changes, even though no consensus changes were made.

With these changes, I think hived’s performance and reliability has been substantially improved over its  past condition and it seems quite solid in the face of very substantial API traffic loading. 

One minor issue still to be resolved is the longstanding issue with hived crashing if it receives API traffic when starting up, so we may tackle that next, since it can be an annoyance when updating several hiveds deployed inside of a API server node configuration. 

**As this version contains substantial operational improvements, we’ve tagged this version as [v1.24.5](https://gitlab.syncad.com/hive/hive/-/releases/v1.24.5), and it’s a strongly recommended upgrade for all API server nodes. However, there’s no need for exchanges or consensus nodes to upgrade to this version, since the performance improvements mostly come into play when a node is handling significant API traffic.**

# Hivemind

We made numerous optimizations and bug fixes in hivemind this past week:

https://gitlab.syncad.com/hive/hivemind/-/merge_requests/311
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/306
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/312
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/314
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/291
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/280
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/316
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/318
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/323
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/226
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/322
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/289
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/315
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/326
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/321
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/325
https://gitlab.syncad.com/hive/hivemind/-/merge_requests/328



## Hivemind status (2nd layer social media microservice)

By late tomorrow I expect we’ll have resolved all the remaining big issues with hivemind responses and performance, other than reputation support (which we’ve intentionally left out until all other issues were resolved).

# Condenser + Condenser wallet (open-source code for **hive.blog**)

Merged in support for decentralized lists:
https://gitlab.syncad.com/hive/condenser/-/merge_requests/135
This functionality is still waiting one last issue to be resolved in hivemind, so it won’t be fully testable until tomorrow when we deploy a new version of hivemind.

We made numerous changes this week to improve condenser’s wallet (corrected some display issues and improved performance of page loads by using newer, faster API calls), including new features in the proposals page:
https://gitlab.syncad.com/hive/wallet/-/merge_requests/42
https://gitlab.syncad.com/hive/wallet/-/merge_requests/43
https://gitlab.syncad.com/hive/wallet/-/merge_requests/45
https://gitlab.syncad.com/hive/wallet/-/merge_requests/52
https://gitlab.syncad.com/hive/wallet/-/merge_requests/54
https://gitlab.syncad.com/hive/wallet/-/merge_requests/55
https://gitlab.syncad.com/hive/wallet/-/merge_requests/56
https://gitlab.syncad.com/hive/wallet/-/merge_requests/57
https://gitlab.syncad.com/hive/wallet/-/merge_requests/60
https://gitlab.syncad.com/hive/wallet/-/merge_requests/62
https://gitlab.syncad.com/hive/wallet/-/merge_requests/64
https://gitlab.syncad.com/hive/wallet/-/merge_requests/65
https://gitlab.syncad.com/hive/wallet/-/merge_requests/68
https://gitlab.syncad.com/hive/wallet/-/merge_requests/70

Proposals page changes:
https://gitlab.syncad.com/hive/wallet/-/merge_requests/47
https://gitlab.syncad.com/hive/wallet/-/merge_requests/49
https://gitlab.syncad.com/hive/wallet/-/merge_requests/51


## Condenser status

Condenser is looking pretty good at this point, but we’ll continue to test and look for any remaining problems.

# Hive-js improvements

In order to make hive.blog faster, we modified hive-js to support the new option to filter the operations fetched by the get_account_history call:
https://gitlab.syncad.com/hive/hive-js/-/merge_requests/12
https://gitlab.syncad.com/hive/hive-js/-/merge_requests/13
https://gitlab.syncad.com/hive/hive-js/-/merge_requests/14



# What’s next for the week?

Tomorrow we’ll hopefully be deploying a new hivemind with all the performance improvements and fixes we made in the last week, after some real world traffic testing on our API node.

We’ll also be testing condenser and the wallet and looking for fixes and optimizations we can make.

**Assuming deployment of latest hivemind goes well tomorrow, we’ll likely still need to make a few more fixes as issues get reported, but I expect that by the latter part of the coming week we can begin to analyze feasibility for various previously suggested features for HF25 and also intermediate changes that aren’t consensus changes that can be released earlier.**</div>
<script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

<script src="https://unpkg.com/steem-content-renderer"></script>

<script>
  $(document).ready(function() {
    try {
      const renderer = new SteemContentRenderer.DefaultRenderer({
        baseUrl: "https://hive.blog/",
        breaks: true,
        skipSanitization: false,
        allowInsecureScriptTags: false,
        addNofollowToLinks: true,
        doNotShowImages: false,
        ipfsPrefix: "",
        assetsWidth: 640,
        assetsHeight: 480,
        imageProxyFn: (url) => url,
        usertagUrlFn: (account) => "/@blocktrades",
        hashtagUrlFn: (hashtag) => "/update-on-blocktrades-hive-core-coding",
        isLinkSafeFn: (url) => true,
      });
      
      const inputElem = $('#content-blocktrades-update-on-blocktrades-hive-core-coding').html();
      const outputElem = $('#content-blocktrades-update-on-blocktrades-hive-core-coding');
      const output = renderer.render(inputElem);
      
      outputElem.html(output);
    } catch(e) {
      console.log(e);
    }
  });
</script>

<style>
  #content-blocktrades-update-on-blocktrades-hive-core-coding {
    padding: 0 3rem;
    color: #444444;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.8;
    text-shadow: 0 1px 0 #ffffff;
    padding: 0.5rem;
  }
  #content-blocktrades-update-on-blocktrades-hive-core-coding code {
    background: white;
  }
  #content-blocktrades-update-on-blocktrades-hive-core-coding a {
    border-bottom: 1px solid #444444; color: #444444; text-decoration: none;
  }
  #content-blocktrades-update-on-blocktrades-hive-core-coding a:hover {
    border-bottom: 0;
  }
  #content-blocktrades-update-on-blocktrades-hive-core-coding h1 {
    font-size: 2.2em;
  }
  #content-blocktrades-update-on-blocktrades-hive-core-coding h2, h3, h4, h5 {
    margin-bottom: 0;
  }
  #content-blocktrades-update-on-blocktrades-hive-core-coding header small {
    color: #999;
    font-size: 50%;
  }
  #content-blocktrades-update-on-blocktrades-hive-core-coding img {
    max-width: 100%;
  }
</style>

<hr />

<p>
  See: <a href="https://hive.blog/hive-139531/@blocktrades/update-on-blocktrades-hive-core-coding">Update on BlockTrades Hive core coding</a>
  by
  <a href="https://hive.blog/@blocktrades">@blocktrades</a>
</p>


  </div><a class="u-url" href="/news/core/development/2020/10/26/update-on-blocktrades-hive-core-coding.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading"><a rel="author" href="/">Hive Chain Documentation</a></h2>
    
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">site curated by: @inertia</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Your resource for various levels of Hive Documentation.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
