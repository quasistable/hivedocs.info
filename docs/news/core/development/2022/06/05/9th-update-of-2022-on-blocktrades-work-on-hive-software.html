<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="/assets/images/sticker.png" />
  <meta name="apple-mobile-web-app-title" content="Hive Docs" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>9th update of 2022 on BlockTrades work on Hive software | Hive Chain Documentation</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="9th update of 2022 on BlockTrades work on Hive software" />
<meta name="author" content="blocktrades" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Recent work on hive blockchain network software" />
<meta property="og:description" content="Recent work on hive blockchain network software" />
<link rel="canonical" href="https://hive.blog/hive-139531/@blocktrades/9th-update-of-2022-on-blocktrades-work-on-hive-software" />
<meta property="og:url" content="https://hive.blog/hive-139531/@blocktrades/9th-update-of-2022-on-blocktrades-work-on-hive-software" />
<meta property="og:site_name" content="Hive Chain Documentation" />
<meta property="og:image" content="https://images.hive.blog/DQmSihw8Kz4U7TuCQa98DDdCzqbqPFRumuVWAbareiYZW1Z/blocktrades%20update.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-05T20:43:18-07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://images.hive.blog/DQmSihw8Kz4U7TuCQa98DDdCzqbqPFRumuVWAbareiYZW1Z/blocktrades%20update.png" />
<meta property="twitter:title" content="9th update of 2022 on BlockTrades work on Hive software" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"blocktrades"},"dateModified":"2022-06-05T20:43:18-07:00","datePublished":"2022-06-05T20:43:18-07:00","description":"Recent work on hive blockchain network software","headline":"9th update of 2022 on BlockTrades work on Hive software","image":"https://images.hive.blog/DQmSihw8Kz4U7TuCQa98DDdCzqbqPFRumuVWAbareiYZW1Z/blocktrades%20update.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://hive.blog/hive-139531/@blocktrades/9th-update-of-2022-on-blocktrades-work-on-hive-software"},"url":"https://hive.blog/hive-139531/@blocktrades/9th-update-of-2022-on-blocktrades-work-on-hive-software"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://hivedocs.info/feed.xml" title="Hive Chain Documentation" /><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-161692811-1', 'auto');
  ga('send', 'pageview');
}
</script>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  
  <!-- jQuery Modal -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turbolinks/5.2.0/turbolinks.js" integrity="sha256-iM4Yzi/zLj/IshPWMC1IluRxTtRjMqjPGd97TZ9yYpU=" crossorigin="anonymous"></script>
  <script src='https://unpkg.com/steem-content-renderer'></script>
  <script>
    (function () {
      if (Turbolinks.supported) {
        Turbolinks.setProgressBarDelay(500);
      }
    })();
  </script>
  <script src="/assets/javascript/universal-bridge-against-phishing.js"></script>
  <script src="/assets/javascript/lazysizes.min.js" async=""></script>
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Cousine|Inconsolata" rel="stylesheet" />
  <link rel="shortcut icon" type="image/png" href="/assets/images/favicon-80x80.png" />
  <link rel="apple-touch-icon" type="image/png" href="/assets/images/favicon-80x80.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicon-80x80.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon-80x80.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="/assets/images/favicon-80x80.png" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Hive Chain Documentation</a>

      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/news/">News</a><a class="page-link" href="/howto/">How To</a><a class="page-link" href="/links/">Useful Links</a><a class="page-link" href="/authors/">Authors</a><!-- HTML elements for search -->
          <input type="text" id="search-input" placeholder="Search" />
          
          <ul id="results-container"></ul>

          <script src="/assets/javascript/search.js"></script>
          <script>
            var sjs = SimpleJekyllSearch({
              searchInput: document.getElementById('search-input'),
              resultsContainer: document.getElementById('results-container'),
              json: '/search.json'
            })
          </script>
          <!-- <form style="float: right;" class="form-inline" method="get" action="http://www.google.com/search">
            <input type="hidden" name="sitesearch" value="hivedocs.info" />
            <input type="text" name="q" maxlength="255" placeholder="Search" />
          </form> -->
          
          <!-- <a href="#" onclick="try { $('#authors-container').slideToggle(); } catch { document.getElementById('authors-container').style.display = 'block'; }; return false;">Authors &#187;</a>
          <a href="#" onclick="try { $('#topics-container').slideToggle(); } catch { document.getElementById('topics-container').style.display = 'block'; }; return false;">Topics &#187;</a> -->
          
          <a href="#topics-container" rel="modal:open">Topics &#187;</a>
          
          <div id="topics-container" class="modal">
            <h3>Topics</h3>
            <ul><li><a class="page-link" href="/account-recovery/"><nobr>Account Recovery</nobr></a></li><li><a class="page-link" href="/core-development/"><nobr>Core Development</nobr></a></li><li><a class="page-link" href="/dapps/"><nobr>Dapps</nobr></a></li><li><a class="page-link" href="/docker/"><nobr>Docker</nobr></a></li><li><a class="page-link" href="/hardfork/"><nobr>Hardfork</nobr></a></li><li><a class="page-link" href="/hivemind/"><nobr>Hivemind</nobr></a></li><li><a class="page-link" href="/javascript/"><nobr>Javascript</nobr></a></li><li><a class="page-link" href="/multisig/"><nobr>Multisig</nobr></a></li><li><a class="page-link" href="/python/"><nobr>Python</nobr></a></li><li><a class="page-link" href="/ruby/"><nobr>Ruby</nobr></a></li><li><a class="page-link" href="/testnet/"><nobr>Testnet</nobr></a></li><li><a class="page-link" href="/tools/"><nobr>Tools</nobr></a></li><li><a class="page-link" href="/witness/"><nobr>Witness</nobr></a></li></ul>
          </div>
        </div>
      </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <div class="pull-right well">
      <img src="https://images.hive.blog/u/blocktrades/avatar" width="128" height="128" class="lazyload" />
    </div>
    
    <h1 class="post-title p-name" itemprop="name headline">9th update of 2022 on BlockTrades work on Hive software</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-06-05T20:43:18-07:00" itemprop="datePublished">Jun 5, 2022
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">
          <a href="/authors/#author-blocktrades">blocktrades</a>
        </span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div id="content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software">![blocktrades update.png](https://images.hive.blog/DQmSihw8Kz4U7TuCQa98DDdCzqbqPFRumuVWAbareiYZW1Z/blocktrades%20update.png)

Below are a few highlights of the Hive-related programming issues worked on by the BlockTrades team since my last post.

# Hived (blockchain node software) work

### Mirrornet (testnet that mirrors traffic from mainnet)

We continued to make updates to the mirrornet code to fix some issues related to transaction expiration and duplicate transactions and we’re now launching a new mirrornet network to resume testing.

### Further optimization of OBI (one-block irreversibility) protocol

The optimizations to the OBI protocol are mostly done, but the dev for this work is currently tied up with another Hive-related coding task, so it still needs to be fully tested.

### Switching from legacy assets to NAI assets is going to delay the hardfork

As I mentioned in my last post, one of the last planned changes to hived was to support assets using “network asset identifiers” instead of strings. When we originally planned this change, it looked fairly simple: when the node received a transaction, it would first try to decode it with NAI assets, then if that failed, fallback to processing the transaction as if the assets were in string format. 

Unfortunately, we found that internally the binary form of the transaction is discarded in favor of a decoded form as a C++ object and then only much later packed back into a binary form. And to support the two formats, there were now going to be several places in the code where we would need to pack with both formats to see which one matched the original format it was signed in and this would add some significant CPU overhead.

Fortunately, there is a better solution to this problem, and it fits well with one of the optimization changes that I mentioned in my last post that we were planning to make after the hardfork related to the new “compressed block” feature we recently added. 

Currently, hived compresses blocks when it writes them to the blocklog (the file that stores all the blockchain blocks), but it can only share blocks over the p2p network in uncompressed form. This leads to some amount of unnecessary compression/decompression of blocks during normal operation and it also means that more data has to be exchanged over the p2p network (because the blocks aren’t shared in compressed form).

So we were already planning to introduce a change after the HF to allow nodes to exchange blocks in either uncompressed or compressed form (the nodes would negotiate during their connection whether or not they understand each other’s compression formats or if they will need to exchange blocks uncompressed). To do this efficiently, we planned to retain the binary form of the block received from a node (as well as the unpacked object that exists today). 

But we decided to implement this optimization now instead of after the HF, because it will yield substantial performance benefits by eliminating a lot of object copying, packing, unpacking, compression, decompression done by the current code; plus it will help with the change to NAI serialization (which can only be done via a HF). 

Preliminary analysis shows that the performance benefits of this change are quite large and should dramatically increase the amount of transactions that can be processed in a block by a hived node.

But it does require reasonably large changes to both the p2p and the block processing code, so I think it is only prudent to allow more time to not only implement the changes, but also perform extensive testing of those changes. My best guess right now is that this will push the HF out to late July.

# Hive Application Framework (HAF)

HAF development is still quite active and  a lot of the current work is focused on creating docker images for the HAF server and associated HAF apps to simplify deployment and management . 

We’ve also added some additional information from the blockchain to the “default” HAF tables based on needs found when developing the HAF-based block explorer.

# HAF account history app (aka hafah)

We found and fixed a few more issues and annoyances with the HAF account history application, plus added some minor features (e.g. get_version API to report the current version of the account history app).

We also updated the benchmarking code to test various aspects of hafah operation. These benchmarks can now test just the internal SQL calls (to analyze the SQL time without the overhead from the web servers), the python-based web server, and the postgREST server (including testing both the legacy API and the new  higher-performance “direct URL” API).

We also did more benchmarking to firmly convince ourselves that the postgREST web server performs better than the python-based one (one of our devs had benchmarks that suggested otherwise, but this appears to have been a fluke). In the end we found that postgREST, as expected, did much better (on average, the response times were about 3x better). We also double-checked that both servers responded the same, to be sure that there wasn’t some functional difference that was responsible for the improved performance.

At this point, there are no known issues with hafah functionality or performance, so I expect we’ll resume real world testing in a production environment this upcoming week.

One further issue I’ve been thinking about lately is that I think we should be able to use hafah to implement the get_block API as well, which would further lower the API processing load on hived nodes AND allow for faster response times I think, but I haven’t had a chance to look at this closely yet.

# HAF-based hivemind (social media middleware server used by web sites)

We completed the work to store hivemind’s tables directly into a hivemind-specific schema in a HAF database (i.e. the same method used by other HAF apps) and we’ve been testing this new version with full syncs to the headblock (i.e. to live sync mode). 

During this testing process, we’ve found and fixed several bugs along the way, but the testing is time-consuming (it takes almost 54 hours to reach live sync, which performance-wise is pretty good for processing of 6 years of blockchain history, but is a long time when you just want to find out if there’s a bug that regular testing didn’t expose).

Anyways, despite the long test times, I think we’re close to completion of this task; at least to the point where it should be a more-than-adequate replacement for the current production version of hivemind (we may be able to make further optimizations later based on the HAF-based design approach).

# HAF-based Hive block explorer

We have a preliminary version of the HAF-based Hive block explorer completed, and I’ll share some screenshots and technical description of it in a separate post later this week. One of the ideas behind this design is to really decentralize the tech behind Hive block explorers so that any HAF server operator can easily run one.

# Some upcoming tasks

* Modify hived to process transactions containing either NAI-based assets or legacy assets. As mentioned in the hived section of this post, this task has morphed into the wrapping of existing block and transaction objects with smarter objects that retain the binary form of these objects (and other meta data which is costly to recompute). This task is currently in progress and I think we’ll have a preliminary version ready for testing next week.
* Merge in new RC cost rationalization code.
* Finish dockerization and CI improvements for HAF and HAF apps.
* Collect benchmarks for a hafah app operating in “irreversible block mode” and compare to a hafah app operating in “normal” mode.
* Test postgREST-based hafah  running inside a docker on a production server (api.hive.blog).
* Complete and benchmark HAF-based hivemind, then deploy and test on our API node.
* Test enhancements to one-block irreversibility (OBI) algorithm.
* Continue testing using updated blockchain converter for mirrornet.

# When hardfork 26?

Due to the unexpected decision to optimize hived p2p and block processing before the hardfork rather than after, the hardfork date has been shifted to late July to ensure we have adequate time to test these changes. 

On the positive side, I’ve pretty certain this will be the last update we make to the hardfork timing, as this should be the last changes we need for the hardfork.

As a side note, several times there have been requests for a summary of the changes made as part of the hardfork and I'll try to put together a list of the changes soon (including non-hardfork changes, since many of those are actually the most significant changes).</div>
<script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

<script src="https://unpkg.com/steem-content-renderer"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/hive-content-renderer/dist/hive-content-renderer.min.js"></script> -->
<script>
  $(document).ready(function() {
    try {
      const renderer = new SteemContentRenderer.DefaultRenderer({
      // const renderer = new HiveContentRenderer({
        baseUrl: "https://hive.blog/",
        breaks: true,
        skipSanitization: false,
        allowInsecureScriptTags: false,
        addNofollowToLinks: true,
        doNotShowImages: false,
        ipfsPrefix: "",
        assetsWidth: 640,
        assetsHeight: 480,
        imageProxyFn: (url) => url,
        usertagUrlFn: (account) => "/@blocktrades",
        hashtagUrlFn: (hashtag) => "/9th-update-of-2022-on-blocktrades-work-on-hive-software",
        isLinkSafeFn: (url) => true,
      });
      
      const inputElem = $('#content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software').html();
      const outputElem = $('#content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software');
      const output = renderer.render(inputElem);
      
      outputElem.html(output);
    } catch(e) {
      console.log(e);
    }
  });
</script>

<style>
  #content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software {
    padding: 0 3rem;
    color: #444444;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.8;
    text-shadow: 0 1px 0 #ffffff;
    padding: 0.5rem;
  }
  #content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software code {
    background: white;
  }
  #content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software a {
    border-bottom: 1px solid #444444; color: #444444; text-decoration: none;
  }
  #content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software a:hover {
    border-bottom: 0;
  }
  #content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software h1 {
    font-size: 2.2em;
  }
  #content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software h2, h3, h4, h5 {
    margin-bottom: 0;
  }
  #content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software header small {
    color: #999;
    font-size: 50%;
  }
  #content-blocktrades-9th-update-of-2022-on-blocktrades-work-on-hive-software img {
    max-width: 100%;
  }
</style>

<hr />

<p>
  See: <a href="https://hive.blog/hive-139531/@blocktrades/9th-update-of-2022-on-blocktrades-work-on-hive-software">9th update of 2022 on BlockTrades work on Hive software</a>
  by
  <a href="https://hive.blog/@blocktrades">@blocktrades</a>
</p>


  </div><a class="u-url" href="/news/core/development/2022/06/05/9th-update-of-2022-on-blocktrades-work-on-hive-software.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading"><a rel="author" href="/">Hive Chain Documentation</a></h2>
    
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">site curated by: @inertia</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Your resource for various levels of Hive Documentation.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
